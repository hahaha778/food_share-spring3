# 美食分享平台数据库设计文档

## 1. E-R图设计
```
[用户(User)] ←──────────────┐
     ↓                      │
     ├──→ [菜谱(Cookbook)] ─┤
     │         ↓           │
     ├──→ [评论(Evaluations)]
     │         ↑           │
     ├──→ [点赞(Interaction)]
     │                     │
[分类(Category)] ←─────────┘
     ↓
     └──→ [营养成分(Nutriment)]
           ↓
     [食谱营养素(Cookbook_Nutriment)]
```

## 2. 数据表详细设计

### 2.1 用户表 (user)
```sql
CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(255) NOT NULL COMMENT '密码',
  `nickname` varchar(50) COMMENT '昵称',
  `avatar` varchar(255) COMMENT '头像URL',
  `email` varchar(100) COMMENT '邮箱',
  `phone` varchar(20) COMMENT '手机号',
  `status` tinyint(1) DEFAULT 1 COMMENT '状态(0:禁用,1:正常)',
  `create_time` datetime COMMENT '创建时间',
  `update_time` datetime COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 2.2 菜谱表 (cookbook)
```sql
CREATE TABLE `cookbook` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '菜谱ID',
  `user_id` int(11) NOT NULL COMMENT '作者ID',
  `category_id` int(11) NOT NULL COMMENT '分类ID',
  `title` varchar(100) NOT NULL COMMENT '标题',
  `content` text NOT NULL COMMENT '内容',
  `cover` varchar(255) COMMENT '封面图URL',
  `ingredients` text COMMENT '食材清单',
  `steps` text COMMENT '制作步骤',
  `tips` text COMMENT '烹饪技巧',
  `difficulty` tinyint(1) COMMENT '难度等级(1-5)',
  `time_needed` int(11) COMMENT '预计时间(分钟)',
  `is_publish` tinyint(1) DEFAULT 0 COMMENT '是否发布',
  `view_count` int(11) DEFAULT 0 COMMENT '浏览次数',
  `like_count` int(11) DEFAULT 0 COMMENT '点赞数',
  `create_time` datetime COMMENT '创建时间',
  `update_time` datetime COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user` (`user_id`),
  KEY `idx_category` (`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜谱表';
```

### 2.3 分类表 (category)
```sql
CREATE TABLE `category` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '分类ID',
  `name` varchar(50) NOT NULL COMMENT '分类名称',
  `parent_id` int(11) DEFAULT 0 COMMENT '父分类ID',
  `sort` int(11) DEFAULT 0 COMMENT '排序',
  `status` tinyint(1) DEFAULT 1 COMMENT '状态(0:禁用,1:正常)',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_parent` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='分类表';
```

### 2.4 评论表 (evaluations)
```sql
CREATE TABLE `evaluations` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '评论ID',
  `parent_id` int(11) DEFAULT NULL COMMENT '父评论ID',
  `cookbook_id` int(11) NOT NULL COMMENT '菜谱ID',
  `user_id` int(11) NOT NULL COMMENT '评论用户ID',
  `content` text NOT NULL COMMENT '评论内容',
  `like_count` int(11) DEFAULT 0 COMMENT '点赞数',
  `status` tinyint(1) DEFAULT 1 COMMENT '状态(0:删除,1:正常)',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_cookbook` (`cookbook_id`),
  KEY `idx_user` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

### 2.5 营养成分表 (nutriment)
```sql
CREATE TABLE `nutriment` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '营养素ID',
  `name` varchar(50) NOT NULL COMMENT '营养素名称',
  `unit` varchar(20) NOT NULL COMMENT '单位',
  `description` text COMMENT '描述',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='营养成分表';
```

### 2.6 食谱营养素关联表 (cookbook_nutriment)
```sql
CREATE TABLE `cookbook_nutriment` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `cookbook_id` int(11) NOT NULL COMMENT '菜谱ID',
  `nutriment_id` int(11) NOT NULL COMMENT '营养素ID',
  `amount` decimal(10,2) NOT NULL COMMENT '含量',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_cookbook_nutriment` (`cookbook_id`,`nutriment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='食谱营养素关联表';
```

## 3. 表关系说明

### 3.1 一对多关系
1. 用户 → 菜谱：一个用户可以发布多个菜谱
2. 分类 → 菜谱：一个分类下可以有多个菜谱
3. 菜谱 → 评论：一个菜谱可以有多个评论
4. 用户 → 评论：一个用户可以发表多个评论

### 3.2 多对多关系
1. 菜谱 ↔ 营养成分：通过cookbook_nutriment表关联
2. 用户 ↔ 菜谱收藏：通过user_cookbook_collection表关联

### 3.3 索引设计
1. 主键索引：所有表都使用自增ID作为主键
2. 外键索引：涉及关联查询的字段都建立索引
3. 唯一索引：用户名等需要唯一性约束的字段
4. 组合索引：经常一起查询的字段组合

## 4. 数据字典

### 4.1 状态码说明
```
用户状态 (user.status)：
0: 禁用
1: 正常

菜谱状态 (cookbook.is_publish)：
0: 草稿
1: 已发布

评论状态 (evaluations.status)：
0: 删除
1: 正常
```

### 4.2 难度等级说明
```
菜谱难度 (cookbook.difficulty)：
1: 新手
2: 初级
3: 中级
4: 高级
5: 大师
```

## 5. 数据库优化建议

### 5.1 索引优化
1. 为常用查询字段创建索引
2. 避免过多索引，影响写入性能
3. 定期维护和更新索引

### 5.2 表结构优化
1. 选择适当的字段类型和长度
2. 适当冗余设计，减少关联查询
3. 大字段分表存储

### 5.3 查询优化
1. 使用预编译SQL
2. 避免全表扫描
3. 合理使用缓存 